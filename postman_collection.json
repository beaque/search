{
	"info": {
		"_postman_id": "verque-api-collection",
		"name": "Verque Search API",
		"description": "Complete API collection for Verque Intelligent Search API deployed at api.verque.app",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "base_url",
			"value": "https://api.verque.app",
			"type": "string"
		},
		{
			"key": "api_key",
			"value": "vq_your_api_key_here",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "your_supabase_user_id",
			"type": "string"
		},
		{
			"key": "user_email",
			"value": "your@email.com",
			"type": "string"
		},
		{
			"key": "stripe_customer_id",
			"value": "cus_xxx",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "Health",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": ["{{base_url}}"],
							"path": ["health"]
						},
						"description": "Check API health status and Redis connection"
					},
					"response": []
				}
			]
		},
		{
			"name": "Search",
			"item": [
				{
					"name": "Search (Basic)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{api_key}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"query\": \"best python frameworks 2024\",\n    \"num_results\": 10\n}"
						},
						"url": {
							"raw": "{{base_url}}/search",
							"host": ["{{base_url}}"],
							"path": ["search"]
						},
						"description": "Basic search with default settings (1 credit + 0.5 per result for classification)"
					},
					"response": []
				},
				{
					"name": "Search (With Classification)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{api_key}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"query\": \"best laptops for programming\",\n    \"num_results\": 5,\n    \"ai_classification\": true,\n    \"verify_claims\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}/search",
							"host": ["{{base_url}}"],
							"path": ["search"]
						},
						"description": "Search with AI classification enabled (adds 0.5 credits per result)"
					},
					"response": []
				},
				{
					"name": "Search (With Verification)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{api_key}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"query\": \"climate change statistics 2024\",\n    \"num_results\": 5,\n    \"ai_classification\": true,\n    \"verify_claims\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/search",
							"host": ["{{base_url}}"],
							"path": ["search"]
						},
						"description": "Full search with classification and claim verification (+5 credits for verification)"
					},
					"response": []
				},
				{
					"name": "Search (Minimal - No Classification)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{api_key}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"query\": \"python tutorials\",\n    \"num_results\": 10,\n    \"ai_classification\": false,\n    \"verify_claims\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}/search",
							"host": ["{{base_url}}"],
							"path": ["search"]
						},
						"description": "Minimal search without classification (only 1 credit)"
					},
					"response": []
				}
			]
		},
		{
			"name": "API Keys",
			"item": [
				{
					"name": "Create API Key",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.key) {",
									"    pm.collectionVariables.set(\"api_key\", jsonData.key);",
									"    console.log(\"API Key saved to collection variable\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"My Test Key\",\n    \"user_id\": \"{{user_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api-keys",
							"host": ["{{base_url}}"],
							"path": ["api-keys"]
						},
						"description": "Create a new API key. The full key is only returned once - save it! Auto-saves to collection variable. stripe_customer_id is optional (only needed for paid users)."
					},
					"response": []
				},
				{
					"name": "List User API Keys",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api-keys/{{user_id}}",
							"host": ["{{base_url}}"],
							"path": ["api-keys", "{{user_id}}"]
						},
						"description": "List all API keys for a user (returns prefix only, not full key)"
					},
					"response": []
				},
				{
					"name": "Delete API Key",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api-keys/{{user_id}}/vq_abc123",
							"host": ["{{base_url}}"],
							"path": ["api-keys", "{{user_id}}", "vq_abc123"]
						},
						"description": "Delete an API key by its prefix"
					},
					"response": []
				}
			]
		},
		{
			"name": "Cache",
			"item": [
				{
					"name": "Get Cache Stats",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/cache/stats",
							"host": ["{{base_url}}"],
							"path": ["cache", "stats"]
						},
						"description": "Get cache statistics and Redis connection status"
					},
					"response": []
				},
				{
					"name": "List Cached Domains",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/cache/domains",
							"host": ["{{base_url}}"],
							"path": ["cache", "domains"]
						},
						"description": "List all cached domains with their data types"
					},
					"response": []
				},
				{
					"name": "Get Domain Cache",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/cache/domain/google.com",
							"host": ["{{base_url}}"],
							"path": ["cache", "domain", "google.com"]
						},
						"description": "Get cached WHOIS, DNS, and PageRank data for a specific domain"
					},
					"response": []
				},
				{
					"name": "Delete Domain Cache",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/cache/domain/example.com",
							"host": ["{{base_url}}"],
							"path": ["cache", "domain", "example.com"]
						},
						"description": "Delete all cached data for a specific domain"
					},
					"response": []
				}
			]
		},
		{
			"name": "Billing - Checkout",
			"item": [
				{
					"name": "Activate Free Tier (2K credits)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"plan\": \"free\",\n    \"user_email\": \"{{user_email}}\",\n    \"user_id\": \"{{user_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/billing/create-checkout-session",
							"host": ["{{base_url}}"],
							"path": ["billing", "create-checkout-session"]
						},
						"description": "Activate free tier - grants 2000 credits instantly. No Stripe redirect. Returns {status: 'activated', credits_granted: 2000} or {status: 'already_active'} if user already has credits."
					},
					"response": []
				},
				{
					"name": "Create Checkout Session (Starter)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"plan\": \"starter\",\n    \"user_email\": \"{{user_email}}\",\n    \"user_id\": \"{{user_id}}\",\n    \"success_url\": \"https://verque.app/success?session_id={CHECKOUT_SESSION_ID}\",\n    \"cancel_url\": \"https://verque.app/pricing\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/billing/create-checkout-session",
							"host": ["{{base_url}}"],
							"path": ["billing", "create-checkout-session"]
						},
						"description": "Create a Stripe checkout session for the starter plan (100 credits)"
					},
					"response": []
				},
				{
					"name": "Create Checkout Session (Pro)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"plan\": \"pro\",\n    \"user_email\": \"{{user_email}}\",\n    \"user_id\": \"{{user_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/billing/create-checkout-session",
							"host": ["{{base_url}}"],
							"path": ["billing", "create-checkout-session"]
						},
						"description": "Create a Stripe checkout session for the pro plan (500 credits)"
					},
					"response": []
				}
			]
		},
		{
			"name": "Billing - Customer & Usage",
			"item": [
				{
					"name": "Get Customer Info",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.customer_id) {",
									"    pm.collectionVariables.set(\"stripe_customer_id\", jsonData.customer_id);",
									"    console.log(\"Stripe Customer ID saved\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/billing/customer/{{user_email}}",
							"host": ["{{base_url}}"],
							"path": ["billing", "customer", "{{user_email}}"]
						},
						"description": "Get Stripe customer info with active subscriptions. Auto-saves customer ID to collection."
					},
					"response": []
				},
				{
					"name": "Record Usage (Manual)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"stripe_customer_id\": \"{{stripe_customer_id}}\",\n    \"credits_used\": 5\n}"
						},
						"url": {
							"raw": "{{base_url}}/billing/record-usage",
							"host": ["{{base_url}}"],
							"path": ["billing", "record-usage"]
						},
						"description": "Manually record credit usage (for testing - usage is auto-recorded on /search)"
					},
					"response": []
				},
				{
					"name": "Get Usage",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/billing/usage/{{user_id}}",
							"host": ["{{base_url}}"],
							"path": ["billing", "usage", "{{user_id}}"]
						},
						"description": "Get current credit balance for a user"
					},
					"response": []
				}
			]
		},
		{
			"name": "Billing - Auto Top-Up",
			"item": [
				{
					"name": "Create Setup Intent",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.client_secret) {",
									"    pm.collectionVariables.set(\"setup_intent_client_secret\", jsonData.client_secret);",
									"    pm.collectionVariables.set(\"setup_intent_id\", jsonData.setup_intent_id);",
									"    console.log(\"Setup Intent saved\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/billing/create-setup-intent?email={{user_email}}",
							"host": ["{{base_url}}"],
							"path": ["billing", "create-setup-intent"],
							"query": [
								{
									"key": "email",
									"value": "{{user_email}}"
								}
							]
						},
						"description": "Create a Stripe SetupIntent to save a payment method for auto top-up"
					},
					"response": []
				},
				{
					"name": "Get Auto Top-Up Settings",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/billing/auto-topup/{{user_email}}",
							"host": ["{{base_url}}"],
							"path": ["billing", "auto-topup", "{{user_email}}"]
						},
						"description": "Get current auto top-up configuration for a user"
					},
					"response": []
				},
				{
					"name": "Configure Auto Top-Up",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{user_email}}\",\n    \"payment_method_id\": \"pm_xxx\",\n    \"enabled\": true,\n    \"threshold\": 10.0,\n    \"package\": \"starter\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/billing/auto-topup/configure",
							"host": ["{{base_url}}"],
							"path": ["billing", "auto-topup", "configure"]
						},
						"description": "Configure auto top-up with a saved payment method"
					},
					"response": []
				},
				{
					"name": "Update Auto Top-Up Settings",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"enabled\": true,\n    \"threshold\": 20.0,\n    \"package\": \"pro\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/billing/auto-topup/{{user_email}}",
							"host": ["{{base_url}}"],
							"path": ["billing", "auto-topup", "{{user_email}}"]
						},
						"description": "Partially update auto top-up settings (enable/disable, change threshold, change package)"
					},
					"response": []
				},
				{
					"name": "Trigger Auto Top-Up Check",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{user_email}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/billing/auto-topup/check",
							"host": ["{{base_url}}"],
							"path": ["billing", "auto-topup", "check"]
						},
						"description": "Manually trigger an auto top-up check (for testing)"
					},
					"response": []
				}
			]
		}
	]
}
